<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web App Test</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-section { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .test-result { padding: 10px; margin: 5px 0; border-radius: 3px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button { background: #007bff; color: white; border: none; padding: 10px 15px; margin: 5px; border-radius: 3px; cursor: pointer; }
        .log { background: #f8f9fa; border: 1px solid #ddd; padding: 10px; height: 300px; overflow-y: auto; font-family: monospace; }
    </style>
</head>
<body>
    <h1>ğŸ§ª English Learning App - Web Test Suite</h1>
    
    <div class="test-section">
        <h3>ì—°ê²° í…ŒìŠ¤íŠ¸</h3>
        <button onclick="testConnection()">ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸</button>
        <div id="connectionResult"></div>
    </div>
    
    <div class="test-section">
        <h3>API í…ŒìŠ¤íŠ¸</h3>
        <button onclick="testHealthAPI()">Health Check</button>
        <button onclick="testAuthAPI()">ì¸ì¦ API</button>
        <div id="apiResult"></div>
    </div>
    
    <div class="test-section">
        <h3>Socket.io í…ŒìŠ¤íŠ¸</h3>
        <button onclick="testSocket()">Socket ì—°ê²°</button>
        <button onclick="testChat()">ì±„íŒ… í…ŒìŠ¤íŠ¸</button>
        <div id="socketResult"></div>
    </div>
    
    <div class="test-section">
        <h3>ì‹¤ì‹œê°„ ë¡œê·¸</h3>
        <div id="testLog" class="log"></div>
        <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
    </div>

    <script>
        let socket = null;
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            logDiv.innerHTML += `<div class="test-result ${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('testLog').innerHTML = '';
        }
        
        async function testConnection() {
            log('ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            try {
                const response = await fetch('http://localhost:3000/health');
                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… ì„œë²„ ì—°ê²° ì„±ê³µ: ${data.status}`, 'success');
                    document.getElementById('connectionResult').innerHTML = '<div class="success">âœ… ì„œë²„ ì—°ê²° ì„±ê³µ</div>';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                log(`âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'error');
                document.getElementById('connectionResult').innerHTML = '<div class="error">âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨</div>';
            }
        }
        
        async function testHealthAPI() {
            log('Health API í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            try {
                const response = await fetch('http://localhost:3000/health');
                const data = await response.json();
                log(`âœ… Health API ì‘ë‹µ: ${JSON.stringify(data)}`, 'success');
                document.getElementById('apiResult').innerHTML = '<div class="success">âœ… Health API ì •ìƒ</div>';
            } catch (error) {
                log(`âŒ Health API ì˜¤ë¥˜: ${error.message}`, 'error');
                document.getElementById('apiResult').innerHTML = '<div class="error">âŒ Health API ì˜¤ë¥˜</div>';
            }
        }
        
        async function testAuthAPI() {
            log('Auth API í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            try {
                const response = await fetch('http://localhost:3000/api/auth/test', {
                    method: 'GET'
                });
                log(`Auth API ì‘ë‹µ ìƒíƒœ: ${response.status}`);
                if (response.ok) {
                    log('âœ… Auth API ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼ ê°€ëŠ¥', 'success');
                } else {
                    log(`Auth API ìƒíƒœ: ${response.status} (ì •ìƒ - ì¸ì¦ í•„ìš”)`, 'success');
                }
            } catch (error) {
                log(`âŒ Auth API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        function testSocket() {
            log('Socket.io ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            socket = io('http://localhost:3000', {
                transports: ['websocket']
            });
            
            socket.on('connect', () => {
                log('âœ… Socket.io ì—°ê²° ì„±ê³µ', 'success');
                document.getElementById('socketResult').innerHTML = '<div class="success">âœ… Socket.io ì—°ê²° ì„±ê³µ</div>';
            });
            
            socket.on('disconnect', () => {
                log('ğŸ”Œ Socket.io ì—°ê²° ëŠì–´ì§');
            });
            
            socket.on('error', (error) => {
                log(`âŒ Socket.io ì˜¤ë¥˜: ${error}`, 'error');
                document.getElementById('socketResult').innerHTML = '<div class="error">âŒ Socket.io ì—°ê²° ì‹¤íŒ¨</div>';
            });
        }
        
        function testChat() {
            if (!socket || !socket.connected) {
                log('âŒ Socketì´ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë¨¼ì € Socket í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.', 'error');
                return;
            }
            
            log('ì±„íŒ… ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            // í…ŒìŠ¤íŠ¸ ì‚¬ìš©ìë¡œ ì¸ì¦
            socket.emit('authenticate', { 
                userId: 'test-user-' + Date.now() 
            });
            
            // ì„¸ì…˜ ì°¸ì—¬
            const sessionId = 'test-session-' + Date.now();
            socket.emit('join_session', {
                sessionId: sessionId,
                userId: 'test-user',
                situationId: 'cafe'
            });
            
            log(`ğŸ“ ì„¸ì…˜ ì°¸ì—¬ ìš”ì²­: ${sessionId}`);
            
            // AI ì‘ë‹µ ë¦¬ìŠ¤ë„ˆ
            socket.on('ai_response', (data) => {
                log(`ğŸ¤– AI ì‘ë‹µ ìˆ˜ì‹ : ${data.response}`, 'success');
            });
            
            socket.on('session_started', (data) => {
                log('âœ… ì„¸ì…˜ ì‹œì‘ë¨', 'success');
                
                // í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡
                setTimeout(() => {
                    socket.emit('send_message', {
                        sessionId: sessionId,
                        message: 'Hello, I would like to order a coffee please.',
                        timestamp: new Date().toISOString()
                    });
                    log('ğŸ“¤ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡: "Hello, I would like to order a coffee please."');
                }, 1000);
            });
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸš€ ì›¹ ì•± í…ŒìŠ¤íŠ¸ ì‹œì‘');
            testConnection();
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <title>Standalone Socket.io Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { padding: 10px 20px; margin: 5px; font-size: 16px; }
        .log { background: #f0f0f0; padding: 10px; margin: 10px 0; min-height: 200px; }
        .connected { color: green; font-weight: bold; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>English Learning App - Socket.io Test</h1>
    
    <div>
        <button onclick="loadSocketIO()">1. Load Socket.io Library</button>
        <button onclick="connectSocket()" disabled id="connectBtn">2. Connect to Server</button>
        <button onclick="testAuth()" disabled id="authBtn">3. Test Authentication</button>
    </div>
    
    <h3>Status: <span id="status">Not started</span></h3>
    
    <div class="log" id="log"></div>
    
    <script>
        let socket = null;
        
        function log(msg, isError = false) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const className = isError ? 'error' : '';
            logDiv.innerHTML += `<div class="${className}">[${time}] ${msg}</div>`;
            console.log(msg);
        }
        
        function loadSocketIO() {
            log('Loading Socket.io library...');
            const script = document.createElement('script');
            script.src = 'https://cdn.socket.io/4.7.5/socket.io.min.js';
            script.onload = function() {
                log('✅ Socket.io library loaded successfully');
                document.getElementById('connectBtn').disabled = false;
                document.getElementById('status').innerText = 'Library loaded';
            };
            script.onerror = function() {
                log('❌ Failed to load Socket.io library', true);
            };
            document.head.appendChild(script);
        }
        
        function connectSocket() {
            if (typeof io === 'undefined') {
                log('❌ Socket.io library not loaded!', true);
                return;
            }
            
            log('Connecting to http://localhost:3000...');
            
            try {
                socket = io('http://localhost:3000', {
                    transports: ['polling', 'websocket'],
                    withCredentials: true,
                    reconnection: true
                });
                
                socket.on('connect', () => {
                    log('✅ Connected! Socket ID: ' + socket.id);
                    document.getElementById('status').innerText = 'Connected';
                    document.getElementById('status').className = 'connected';
                    document.getElementById('authBtn').disabled = false;
                });
                
                socket.on('connect_error', (error) => {
                    log('❌ Connection error: ' + error.message + ' (Type: ' + error.type + ')', true);
                    document.getElementById('status').innerText = 'Connection failed';
                });
                
                socket.on('disconnect', (reason) => {
                    log('Disconnected: ' + reason);
                    document.getElementById('status').innerText = 'Disconnected';
                });
                
                socket.on('authenticated', (data) => {
                    log('✅ Authentication successful: ' + JSON.stringify(data));
                });
                
                socket.on('error', (error) => {
                    log('❌ Error: ' + JSON.stringify(error), true);
                });
                
            } catch (error) {
                log('❌ Exception: ' + error.message, true);
            }
        }
        
        function testAuth() {
            if (!socket || !socket.connected) {
                log('❌ Not connected!', true);
                return;
            }
            
            log('Sending authentication request...');
            socket.emit('authenticate', { userId: 'browser-test-user' });
        }
    </script>
</body>
</html>